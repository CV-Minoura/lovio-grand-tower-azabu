---
---

<section id="introduction" data-section="P1-S2" class="relative py-48 md:py-64 lg:py-80 bg-background overflow-hidden">
  <!-- Background Effects -->
  <div class="intro-bg-effects absolute inset-0 pointer-events-none">
    <!-- Radial Gradient Pulse -->
    <div class="intro-radial absolute inset-0"></div>

    <!-- Floating Particles -->
    <div class="intro-particles">
      <div class="particle particle-1"></div>
      <div class="particle particle-2"></div>
      <div class="particle particle-3"></div>
      <div class="particle particle-4"></div>
      <div class="particle particle-5"></div>
      <div class="particle particle-6"></div>
    </div>

    <!-- Horizontal Lines -->
    <div class="intro-lines">
      <div class="h-line h-line-1"></div>
      <div class="h-line h-line-2"></div>
    </div>
  </div>

  <div class="container-narrow relative z-10">
    <!-- Top Accent -->
    <div class="intro-accent-top flex justify-center mb-16 opacity-0">
      <div class="w-12 h-[1px] bg-accent-gold"></div>
      <div class="w-2 h-2 border border-accent-gold rotate-45 mx-4 -mt-[3px]"></div>
      <div class="w-12 h-[1px] bg-accent-gold"></div>
    </div>

    <div class="intro-content text-center">
      <!-- Line 1: 東京の中心で、静謐と眺望を手にする。 -->
      <div class="intro-line-wrapper overflow-hidden mb-6 md:mb-8">
        <p class="intro-line intro-line-1 font-display text-xl md:text-2xl lg:text-3xl xl:text-4xl leading-relaxed tracking-wide opacity-0">
          <span class="intro-char-wrap"><span class="intro-char glitch-char" data-char="東">東</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char" data-char="京">京</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char" data-char="の">の</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char" data-char="中">中</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char" data-char="心">心</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char" data-char="で">で</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char" data-char="、">、</span></span><span class="intro-char-wrap mx-2"></span><span class="intro-char-wrap"><span class="intro-char glitch-char highlight-word" data-char="静">静</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char highlight-word" data-char="謐">謐</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char" data-char="と">と</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char highlight-word" data-char="眺">眺</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char highlight-word" data-char="望">望</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char" data-char="を">を</span></span><span class="intro-char-wrap mx-2"></span><span class="intro-char-wrap"><span class="intro-char glitch-char" data-char="手">手</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char" data-char="に">に</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char" data-char="す">す</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char" data-char="る">る</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char" data-char="。">。</span></span>
        </p>
      </div>

      <!-- Line 2: 麻布の丘に誕生する、 -->
      <div class="intro-line-wrapper overflow-hidden mb-6 md:mb-8">
        <p class="intro-line intro-line-2 font-display text-xl md:text-2xl lg:text-3xl xl:text-4xl leading-relaxed tracking-wide opacity-0">
          <span class="intro-char-wrap"><span class="intro-char glitch-char highlight-word" data-char="麻">麻</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char highlight-word" data-char="布">布</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char" data-char="の">の</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char" data-char="丘">丘</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char" data-char="に">に</span></span><span class="intro-char-wrap mx-2"></span><span class="intro-char-wrap"><span class="intro-char glitch-char" data-char="誕">誕</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char" data-char="生">生</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char" data-char="す">す</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char" data-char="る">る</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char" data-char="、">、</span></span>
        </p>
      </div>

      <!-- Line 3: 全120邸のプライベートレジデンス。 -->
      <div class="intro-line-wrapper overflow-hidden">
        <p class="intro-line intro-line-3 font-display text-xl md:text-2xl lg:text-3xl xl:text-4xl leading-relaxed tracking-wide opacity-0">
          <span class="intro-char-wrap"><span class="intro-char glitch-char" data-char="全">全</span></span><span class="intro-char-wrap mx-1"></span><span class="intro-number-wrap"><span class="intro-number font-serif text-accent-gold" data-target="120">0</span></span><span class="intro-char-wrap mx-1"></span><span class="intro-char-wrap"><span class="intro-char glitch-char" data-char="邸">邸</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char" data-char="の">の</span></span><span class="intro-char-wrap mx-2"></span><span class="intro-char-wrap"><span class="intro-char glitch-char highlight-word" data-char="プ">プ</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char highlight-word" data-char="ラ">ラ</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char highlight-word" data-char="イ">イ</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char highlight-word" data-char="ベ">ベ</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char highlight-word" data-char="ー">ー</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char highlight-word" data-char="ト">ト</span></span><span class="intro-char-wrap mx-1"></span><span class="intro-char-wrap"><span class="intro-char glitch-char highlight-word" data-char="レ">レ</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char highlight-word" data-char="ジ">ジ</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char highlight-word" data-char="デ">デ</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char highlight-word" data-char="ン">ン</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char highlight-word" data-char="ス">ス</span></span><span class="intro-char-wrap"><span class="intro-char glitch-char" data-char="。">。</span></span>
        </p>
      </div>
    </div>

    <!-- Bottom Accent -->
    <div class="intro-accent-bottom flex justify-center mt-16 opacity-0">
      <div class="w-12 h-[1px] bg-accent-gold"></div>
      <div class="w-2 h-2 border border-accent-gold rotate-45 mx-4 -mt-[3px]"></div>
      <div class="w-12 h-[1px] bg-accent-gold"></div>
    </div>

    <!-- Typewriter Cursor -->
    <div class="typewriter-cursor absolute opacity-0"></div>
  </div>

  <!-- Decorative Side Lines -->
  <div class="intro-side-decor left-8 md:left-16 lg:left-24">
    <div class="side-line"></div>
    <div class="side-dot"></div>
  </div>
  <div class="intro-side-decor right-8 md:right-16 lg:right-24">
    <div class="side-line"></div>
    <div class="side-dot"></div>
  </div>

  <!-- Bottom Decorative Line -->
  <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-[1px] h-32 intro-bottom-line"></div>
</section>

<script>
  import { gsap } from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  gsap.registerPlugin(ScrollTrigger);

  const initIntroduction = () => {
    const section = document.getElementById('introduction');
    const lines = document.querySelectorAll('.intro-line');
    const chars = document.querySelectorAll('.intro-char');
    const numberEl = document.querySelector('.intro-number') as HTMLElement;
    const accentTop = document.querySelector('.intro-accent-top');
    const accentBottom = document.querySelector('.intro-accent-bottom');
    const sideDecors = document.querySelectorAll('.intro-side-decor');
    const particles = document.querySelectorAll('.particle');
    const cursor = document.querySelector('.typewriter-cursor');

    // Scramble characters set
    const scrambleChars = 'アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヲン';
    const scrambleCharsEn = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';

    // Text scramble effect for single character
    const scrambleChar = (element: HTMLElement, finalChar: string, delay: number = 0) => {
      const isJapanese = /[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/.test(finalChar);
      const charSet = isJapanese ? scrambleChars : scrambleCharsEn;
      let iteration = 0;
      const maxIterations = 8;

      setTimeout(() => {
        const interval = setInterval(() => {
          if (iteration < maxIterations) {
            element.textContent = charSet[Math.floor(Math.random() * charSet.length)];
            iteration++;
          } else {
            element.textContent = finalChar;
            clearInterval(interval);
          }
        }, 40);
      }, delay);
    };

    // Glitch effect
    const glitchChar = (element: HTMLElement) => {
      element.classList.add('glitching');
      setTimeout(() => element.classList.remove('glitching'), 150);
    };

    // Number counter animation
    const countUp = (element: HTMLElement, target: number, duration: number = 2000) => {
      const startTime = performance.now();
      const animate = (currentTime: number) => {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const easeOut = 1 - Math.pow(1 - progress, 3);
        const current = Math.floor(easeOut * target);
        element.textContent = current.toString();
        if (progress < 1) {
          requestAnimationFrame(animate);
        }
      };
      requestAnimationFrame(animate);
    };

    // Mouse parallax for particles
    let mouseX = 0;
    let mouseY = 0;

    section?.addEventListener('mousemove', (e) => {
      const rect = section.getBoundingClientRect();
      mouseX = (e.clientX - rect.left) / rect.width - 0.5;
      mouseY = (e.clientY - rect.top) / rect.height - 0.5;

      particles.forEach((particle, i) => {
        const speed = (i + 1) * 15;
        gsap.to(particle, {
          x: mouseX * speed,
          y: mouseY * speed,
          duration: 0.5,
          ease: 'power2.out'
        });
      });
    });

    // Main scroll-triggered animation
    ScrollTrigger.create({
      trigger: '#introduction',
      start: 'top 65%',
      onEnter: () => {
        // Timeline for sequenced animations
        const tl = gsap.timeline();

        // Fade in background effects
        tl.to('.intro-radial', {
          opacity: 1,
          scale: 1,
          duration: 1.5,
          ease: 'power2.out'
        }, 0);

        // Particles fade in
        tl.to(particles, {
          opacity: 1,
          duration: 0.8,
          stagger: 0.1
        }, 0.3);

        // Top accent
        tl.to(accentTop, {
          opacity: 1,
          duration: 0.6,
          ease: 'power2.out'
        }, 0.2);

        // Side decorations
        tl.to(sideDecors, {
          opacity: 1,
          duration: 0.8,
          stagger: 0.2
        }, 0.3);

        // Line 1 animation
        tl.to('.intro-line-1', {
          opacity: 1,
          duration: 0.3
        }, 0.5);

        // Character reveal with scramble for Line 1
        const line1Chars = document.querySelectorAll('.intro-line-1 .intro-char');
        line1Chars.forEach((char, i) => {
          const el = char as HTMLElement;
          const finalChar = el.dataset.char || '';

          tl.fromTo(el,
            { opacity: 0, y: 20, rotateX: -90 },
            {
              opacity: 1,
              y: 0,
              rotateX: 0,
              duration: 0.4,
              ease: 'back.out(1.5)',
              onStart: () => {
                scrambleChar(el, finalChar, 0);
                glitchChar(el);
              }
            },
            0.6 + i * 0.04
          );
        });

        // Line 2 animation
        tl.to('.intro-line-2', {
          opacity: 1,
          duration: 0.3
        }, 1.5);

        const line2Chars = document.querySelectorAll('.intro-line-2 .intro-char');
        line2Chars.forEach((char, i) => {
          const el = char as HTMLElement;
          const finalChar = el.dataset.char || '';

          tl.fromTo(el,
            { opacity: 0, y: 20, rotateX: -90 },
            {
              opacity: 1,
              y: 0,
              rotateX: 0,
              duration: 0.4,
              ease: 'back.out(1.5)',
              onStart: () => {
                scrambleChar(el, finalChar, 0);
                glitchChar(el);
              }
            },
            1.6 + i * 0.04
          );
        });

        // Line 3 animation
        tl.to('.intro-line-3', {
          opacity: 1,
          duration: 0.3
        }, 2.3);

        const line3Chars = document.querySelectorAll('.intro-line-3 .intro-char');
        line3Chars.forEach((char, i) => {
          const el = char as HTMLElement;
          const finalChar = el.dataset.char || '';

          tl.fromTo(el,
            { opacity: 0, y: 20, rotateX: -90 },
            {
              opacity: 1,
              y: 0,
              rotateX: 0,
              duration: 0.4,
              ease: 'back.out(1.5)',
              onStart: () => {
                scrambleChar(el, finalChar, 0);
                glitchChar(el);
              }
            },
            2.4 + i * 0.04
          );
        });

        // Number animation with special effect
        if (numberEl) {
          tl.fromTo('.intro-number-wrap',
            { opacity: 0, scale: 0.5 },
            {
              opacity: 1,
              scale: 1,
              duration: 0.6,
              ease: 'back.out(2)',
              onStart: () => {
                countUp(numberEl, 120, 1500);
              }
            },
            2.5
          );

          // Number glow pulse
          tl.to(numberEl, {
            textShadow: '0 0 30px rgba(201, 169, 110, 0.8), 0 0 60px rgba(201, 169, 110, 0.4)',
            duration: 0.3,
            yoyo: true,
            repeat: 1
          }, 2.8);
        }

        // Bottom accent
        tl.to(accentBottom, {
          opacity: 1,
          duration: 0.6,
          ease: 'power2.out'
        }, 3.2);

        // Bottom line grow
        tl.fromTo('.intro-bottom-line',
          { scaleY: 0, transformOrigin: 'top' },
          { scaleY: 1, duration: 1, ease: 'power2.out' },
          3.4
        );
      }
    });

    // Hover effects for characters
    chars.forEach(char => {
      char.addEventListener('mouseenter', () => {
        glitchChar(char as HTMLElement);
        gsap.to(char, {
          scale: 1.1,
          color: '#C9A96E',
          duration: 0.2
        });
      });

      char.addEventListener('mouseleave', () => {
        gsap.to(char, {
          scale: 1,
          color: '',
          duration: 0.3
        });
      });
    });

    // Periodic subtle glitch on random characters
    setInterval(() => {
      if (Math.random() > 0.7) {
        const randomChar = chars[Math.floor(Math.random() * chars.length)] as HTMLElement;
        if (randomChar) {
          glitchChar(randomChar);
        }
      }
    }, 3000);

    // Parallax on scroll
    gsap.to('.intro-content', {
      scrollTrigger: {
        trigger: '#introduction',
        start: 'top bottom',
        end: 'bottom top',
        scrub: 1
      },
      y: -30,
      ease: 'none'
    });
  };

  document.addEventListener('DOMContentLoaded', initIntroduction);
</script>

<style>
  /* ========================================
     BACKGROUND EFFECTS
     ======================================== */
  .intro-radial {
    background: radial-gradient(
      ellipse at center,
      rgba(201, 169, 110, 0.03) 0%,
      transparent 50%
    );
    opacity: 0;
    transform: scale(0.8);
  }

  .particle {
    position: absolute;
    width: 4px;
    height: 4px;
    background: radial-gradient(circle, rgba(201, 169, 110, 0.6) 0%, transparent 70%);
    border-radius: 50%;
    opacity: 0;
  }

  .particle-1 { top: 20%; left: 15%; }
  .particle-2 { top: 30%; right: 20%; }
  .particle-3 { top: 50%; left: 10%; }
  .particle-4 { top: 60%; right: 15%; }
  .particle-5 { top: 75%; left: 25%; }
  .particle-6 { top: 40%; right: 30%; }

  .particle::after {
    content: '';
    position: absolute;
    inset: -2px;
    background: inherit;
    border-radius: 50%;
    filter: blur(4px);
    opacity: 0.5;
  }

  .h-line {
    position: absolute;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(201, 169, 110, 0.2), transparent);
    opacity: 0;
    animation: hLineFloat 8s ease-in-out infinite;
  }

  .h-line-1 {
    top: 30%;
    left: 10%;
    width: 30%;
    animation-delay: 0s;
  }

  .h-line-2 {
    top: 70%;
    right: 10%;
    width: 25%;
    animation-delay: 4s;
  }

  @keyframes hLineFloat {
    0%, 100% { opacity: 0; transform: translateX(-20px); }
    50% { opacity: 0.5; transform: translateX(20px); }
  }

  /* ========================================
     CHARACTER STYLING
     ======================================== */
  .intro-char-wrap {
    display: inline-block;
    perspective: 500px;
  }

  .intro-char {
    display: inline-block;
    will-change: transform, opacity;
    transition: color 0.3s ease, text-shadow 0.3s ease;
    cursor: default;
  }

  .highlight-word {
    color: var(--color-text-primary);
    text-shadow: 0 0 20px rgba(201, 169, 110, 0.3);
  }

  .highlight-word:hover {
    text-shadow: 0 0 30px rgba(201, 169, 110, 0.6);
  }

  /* ========================================
     GLITCH EFFECT
     ======================================== */
  .glitch-char {
    position: relative;
  }

  .glitch-char::before,
  .glitch-char::after {
    content: attr(data-char);
    position: absolute;
    top: 0;
    left: 0;
    opacity: 0;
    pointer-events: none;
  }

  .glitch-char::before {
    color: rgba(255, 0, 0, 0.8);
    z-index: -1;
  }

  .glitch-char::after {
    color: rgba(0, 255, 255, 0.8);
    z-index: -1;
  }

  .glitch-char.glitching::before {
    opacity: 1;
    animation: glitchBefore 0.15s ease-in-out;
  }

  .glitch-char.glitching::after {
    opacity: 1;
    animation: glitchAfter 0.15s ease-in-out;
  }

  @keyframes glitchBefore {
    0% { transform: translate(0); }
    20% { transform: translate(-2px, 1px); }
    40% { transform: translate(2px, -1px); }
    60% { transform: translate(-1px, 2px); }
    80% { transform: translate(1px, -2px); }
    100% { transform: translate(0); }
  }

  @keyframes glitchAfter {
    0% { transform: translate(0); }
    20% { transform: translate(2px, -1px); }
    40% { transform: translate(-2px, 1px); }
    60% { transform: translate(1px, -2px); }
    80% { transform: translate(-1px, 2px); }
    100% { transform: translate(0); }
  }

  /* ========================================
     NUMBER STYLING
     ======================================== */
  .intro-number-wrap {
    display: inline-block;
    opacity: 0;
  }

  .intro-number {
    font-size: 1.5em;
    font-weight: 500;
    letter-spacing: 0.05em;
    text-shadow: 0 0 20px rgba(201, 169, 110, 0.5);
    transition: text-shadow 0.3s ease;
  }

  .intro-number:hover {
    text-shadow: 0 0 40px rgba(201, 169, 110, 0.8), 0 0 80px rgba(201, 169, 110, 0.4);
  }

  /* ========================================
     SIDE DECORATIONS
     ======================================== */
  .intro-side-decor {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    opacity: 0;
  }

  .side-line {
    width: 1px;
    height: 120px;
    background: linear-gradient(to bottom, transparent, rgba(201, 169, 110, 0.4), transparent);
    margin: 0 auto;
  }

  .side-dot {
    width: 6px;
    height: 6px;
    background: var(--color-accent-gold);
    border-radius: 50%;
    margin: 12px auto 0;
    animation: dotPulse 2s ease-in-out infinite;
  }

  @keyframes dotPulse {
    0%, 100% { opacity: 0.5; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.2); }
  }

  /* ========================================
     BOTTOM LINE
     ======================================== */
  .intro-bottom-line {
    background: linear-gradient(to bottom, rgba(201, 169, 110, 0.6), transparent);
  }

  /* ========================================
     LINE WRAPPER
     ======================================== */
  .intro-line-wrapper {
    overflow: hidden;
  }

  .intro-line {
    line-height: 2.2;
  }

  /* ========================================
     ACCENT DECORATIONS
     ======================================== */
  .intro-accent-top,
  .intro-accent-bottom {
    transition: opacity 0.6s ease;
  }

  .intro-accent-top > div:first-child,
  .intro-accent-top > div:last-child,
  .intro-accent-bottom > div:first-child,
  .intro-accent-bottom > div:last-child {
    transition: width 0.6s ease;
  }

  /* ========================================
     TYPEWRITER CURSOR
     ======================================== */
  .typewriter-cursor {
    width: 2px;
    height: 1.2em;
    background: var(--color-accent-gold);
    animation: cursorBlink 0.8s ease-in-out infinite;
  }

  @keyframes cursorBlink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0; }
  }

  /* ========================================
     RESPONSIVE
     ======================================== */
  @media (max-width: 768px) {
    .intro-side-decor {
      display: none;
    }

    .particle {
      display: none;
    }
  }

  /* ========================================
     REDUCED MOTION
     ======================================== */
  @media (prefers-reduced-motion: reduce) {
    .intro-char,
    .particle,
    .h-line,
    .side-dot {
      animation: none !important;
    }

    .glitch-char::before,
    .glitch-char::after {
      display: none;
    }
  }
</style>
