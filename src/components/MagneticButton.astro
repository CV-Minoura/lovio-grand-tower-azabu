---
// Magnetic Button Component
// カーソルに引き寄せられるボタン効果
interface Props {
  href?: string;
  variant?: 'primary' | 'outline';
  class?: string;
}

const { href = '#', variant = 'primary', class: className = '' } = Astro.props;
const btnClass = variant === 'primary' ? 'btn-primary' : 'btn-outline';
---

<a
  href={href}
  class:list={['magnetic-btn', 'btn', btnClass, className]}
  data-magnetic
>
  <span class="magnetic-btn-text relative z-10">
    <slot />
  </span>
  <span class="magnetic-btn-bg absolute inset-0 bg-accent-gold transform scale-x-0 origin-left transition-transform duration-300"></span>
</a>

<script>
  import { gsap } from 'gsap';

  const initMagneticButtons = () => {
    if (window.innerWidth < 768) return;

    document.querySelectorAll('[data-magnetic]').forEach(btn => {
      const btnEl = btn as HTMLElement;
      const text = btnEl.querySelector('.magnetic-btn-text');

      btnEl.addEventListener('mousemove', (e) => {
        const rect = btnEl.getBoundingClientRect();
        const x = e.clientX - rect.left - rect.width / 2;
        const y = e.clientY - rect.top - rect.height / 2;

        // Button follows cursor
        gsap.to(btnEl, {
          x: x * 0.3,
          y: y * 0.3,
          duration: 0.3,
          ease: 'power2.out'
        });

        // Text has more movement
        if (text) {
          gsap.to(text, {
            x: x * 0.15,
            y: y * 0.15,
            duration: 0.3,
            ease: 'power2.out'
          });
        }
      });

      btnEl.addEventListener('mouseleave', () => {
        gsap.to(btnEl, {
          x: 0,
          y: 0,
          duration: 0.5,
          ease: 'elastic.out(1, 0.5)'
        });

        if (text) {
          gsap.to(text, {
            x: 0,
            y: 0,
            duration: 0.5,
            ease: 'elastic.out(1, 0.5)'
          });
        }
      });

      // Hover background effect for outline buttons
      if (btnEl.classList.contains('btn-outline')) {
        const bg = btnEl.querySelector('.magnetic-btn-bg');
        btnEl.addEventListener('mouseenter', () => {
          gsap.to(bg, { scaleX: 1, duration: 0.3, ease: 'power2.out' });
          gsap.to(text, { color: '#0A0A0F', duration: 0.3 });
        });
        btnEl.addEventListener('mouseleave', () => {
          gsap.to(bg, { scaleX: 0, duration: 0.3, ease: 'power2.out' });
          gsap.to(text, { color: '', duration: 0.3 });
        });
      }
    });
  };

  document.addEventListener('DOMContentLoaded', initMagneticButtons);
</script>

<style>
  .magnetic-btn {
    will-change: transform;
    position: relative;
    overflow: hidden;
  }

  .magnetic-btn-text {
    will-change: transform, color;
  }

  .magnetic-btn-bg {
    will-change: transform;
  }
</style>
